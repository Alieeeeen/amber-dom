!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.amberdom=t()}(this,function(){"use strict";function e(e){return"[object Array]"===Object.prototype.toString.call(e)}const t=/^ev\-([a-z]+)/;class n{constructor(e,t,o){this.tagName=e,this.props=t,this.children=o,this.key=t&&t.key,this.cleanups=[],this.count=o&&o.reduce((e,t)=>t instanceof n?t.count+e+1:e+1,0),this.key&&delete t.key}render(){const e=/(SVG|svg)/.test(this.tagName)?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement(this.tagName),o=this.props;for(const n in o)if(o.hasOwnProperty(n)){const s=n.match(t);if(s)try{const t="function"==typeof o[n]?o[n]:new Function(`(${o[n]})(...arguments);`);this.cleanups.push({evName:s[1],handler:t}),e.addEventListener(s[1],t,!1)}catch(e){console.log(`Warning: listener for event '${_event[1]}' isn't working.\n              If you're specifying this handler in string, please specify a function.`)}else"className"===n?e.setAttribute("class",o[n]):e.setAttribute(n,o[n])}return this.children.forEach(t=>{var o;if("string"==typeof t)o=document.createTextNode(t);else{if(!(t instanceof n||t.render&&"function"==typeof t.render))throw new Error("Custom-defined node must provide a `render` method.");o=t.render()}e.appendChild(o)}),this.$el=e,e}detachEventListeners(){this.cleanups.forEach(e=>{this.$el.removeEventListener(e.evName,e.handler)})}}const o=/([\.#]?[^\s#.]+)/;const s={REPLACE:"REPLACE",REORDER:"REORDER",PROPS:"PROPS",TEXT:"TEXT"};function r(e,t){return e.map((e,n)=>t&&e?"function"==typeof t?t(e):e[t]:void 0)}function i(e){for(const t of e)if(void 0!==t)return!1;return!0}const{REPLACE:c,REORDER:a,TEXT:d,PROPS:f}=s;function l(e,t,n,o){var s,u,h=[];return void 0===t?n:"string"==typeof e&&"string"==typeof t?(e===t||(n[o]=[{type:d,text:t}]),n):(s=function(e,t){var n,o={};for(const s in t)t.hasOwnProperty(s)&&(n=t[s],e[s]!==n&&(o[s]=n));for(const n in e)n in t||(o[n]=void 0);return o}(e.props||{},t.props||{}),e.tagName!==t.tagName||e.key!==t.key?(h.push({type:c,node:t,oldNode:e}),n[o]=h,n):(u=s,0!==Object.keys(u||{}).length&&(h.push({type:f,props:s,node:e}),t.$el=e.$el),function(e,t,n,o,s){const c=function(e,t,n){const o=r(e,n),s=r(t,n),c=e.length,a=t.length;let d=e.slice(),f=[];if(i(o)&&i(s)){let e,n,o,s;if(c===a)return{diffed:d,moves:f};c>a?(e="REMOVE",n=a,o=c,d.splice(a,c-a)):a>c&&(e="INSERT",n=c,o=a,s=t.slice(c),d=[...d,...s]);for(let s=n;s<o;s++)f.push({type:e,index:s,node:t[s]||null});return{diffed:d,moves:f}}let l=new Array(c).fill(0);return s.forEach((n,s)=>{let r=o.indexOf(n);if(-1===r)f.push({type:"INSERT",index:s,node:t[s]}),d.splice(s,0,t[s]),l[c-1]++;else{let n=r;for(let e=c-1;e>=r;e--)n+=l[e];if(s===n)return void(t[s].$el=e[n].$el);f.push({type:"MOVE",from:n,to:s});let o=d.splice(n,1)[0];d.splice(s,0,o),t[s].$el=e[n].$el,l[r]++}}),o.forEach((e,t)=>{-1===s.indexOf(e)&&f.push({type:"REMOVE",index:a,node:d.splice(a,1)[0]})}),{diffed:d,moves:f}}(e,t,"key");e=c.diffed,c.moves.length&&o.push({type:a,moves:c.moves});var d=null,f=s;e.forEach((e,o)=>{t[o];f=d&&d.count?d.count+f+1:f+1,l(e,t[o],n,f),d=e})}(e.children||[],t.children||[],n,h,o),h.length&&(n[o]=h),n))}const{REPLACE:u,REORDER:h,PROPS:p,TEXT:m}=s;return{h:function(t,s,...r){var i;if("function"==typeof t)return new t(s,...r);if(s||(s={}),r||(r=[]),(s instanceof n||"string"==typeof s)&&(r.unshift(s),s={}),e(s)&&(r=[...s,r],s={}),s.style&&"object"==typeof s.style){let e="";for(const t in s.style)e+=`${t}: ${s.style[t]}; `;s.style=e}if(s.className&&e(s.className)&&(s.className=s.className.join(" ")),"string"==typeof t)return(i=function(e){const t={};return e.split(o).forEach(e=>{""!==e&&(t.tagName?"."===e[0]?(t.className||(t.className=[])).push(e.substr(1)):"#"===e[0]&&(t.id=e.substr(1)):t.tagName=e)}),t.className&&t.className.join(" "),t}(t)).className&&(s.className||(s.className=""),s.className+=" "+i.className),i.id&&(s.id=s.id?s.id:i.id),new n(i.tagName,s,r);throw new Error("The first parameter to `h` function must be a string or a function.")},diff:function(e,t){const n={};return l(e,t,n,0),n},patch:function(e,o){!function e(o,s,r){const i=s[r.index];let c=!1;if(i&&(c=function(e,o){let s,r,i,c=!1;return o.forEach(o=>{switch(o.type){case u:if((r=o.node instanceof n||o.node.render?o.node.render():"string"==typeof o.node?document.createTextNode(o.node):new Error("You might be using a custom-defined node extended from VNode, if so, provide a render function."))instanceof Error)throw r;o.oldNode.detachEventListeners(),e.parentNode.replaceChild(r,e),c=!0;break;case p:s=o.props;for(let n in s)(i=n.match(t))?(o.node.detachEventListeners(),"function"==typeof s[n]&&e.addEventListener(i[1],s[n],!1)):void 0===s[n]?e.removeAttribute("className"!==n?n:"class"):e.setAttribute("className"!==n?n:"class",s[n]);break;case m:e.textContent?e.textContent=o.text:e.nodeValue=o.text;break;case h:!function(e,t){const n=e.childNodes;let o;t.forEach(t=>{switch(t.type){case"INSERT":try{o=t.node.render(),e.insertBefore(o,n[t.index])}catch(e){console.log("You might be using a custom-defined node extended from VNode, if so, provide a render function.")}break;case"REMOVE":e.removeChild(n[t.index]),t.node.detachEventListeners();break;case"MOVE":e.insertBefore(n[t.from],n[t.to])}})}(e,o.moves);break;default:throw new Error("Some internal error.")}}),c}(o,i)),o.childNodes&&!c){const t=[].slice.call(o.childNodes);t.forEach((t,n)=>{r.index++,e(t,s,r)})}else c&&(r.index+=i[0].oldNode.count)}(e,o,{index:0})},VNode:n}});
//# sourceMappingURL=amberdom.min.js.map
